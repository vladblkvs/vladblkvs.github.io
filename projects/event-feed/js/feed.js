import{data}from"./data.js";import{Drag}from"./drag-core.js";const feed=document.querySelector(".feed"),feedList=feed.querySelector(".feed__list");export const recieveNotificationCount=function(){document.querySelectorAll(".notification").forEach(e=>{e.textContent=data.notificationCount,data.notificationCount||(e.style.display="none")})};const renderFeed=function(e){const t=document.querySelector("#feed-post-template").content.querySelector(".feed__item"),o=document.querySelector("#feed-artist-template").content.querySelector(".feed__artist"),n=document.querySelector("#feed-vid-duration-template").content.querySelector(".feed__video-duration"),d=document.querySelector("#feed-location-template").content.querySelector(".feed__location"),r=document.querySelector("#feed-date-template").content.querySelector(".feed__date");e.forEach(e=>{const i=t.cloneNode(!0),c=i.querySelector(".feed__image"),a=i.querySelector(".feed__item-title"),s=i.querySelector(".feed__link"),l=i.querySelector(".feed__addition");if(i.classList.add("feed__item--"+e.type),c.src=e.image,a.textContent=e.title,s.href=e.link,e.bookmark&&i.classList.add("feed__item--bookmarked"),e.new&&i.classList.add("feed__item--new"),e.recommendation){i.classList.add("feed__item--recommended");const t=i.querySelector(".feed__recommendation").querySelector(".link");t.textContent=e.recommendation.name,t.href=e.recommendation.link}if(e.artist){const t=o.cloneNode(!0);t.textContent=e.artist,l.appendChild(t)}if(e.duration){const t=n.cloneNode(!0);t.textContent=e.duration,l.appendChild(t)}if(e.location){const t=d.cloneNode(!0);t.textContent=e.location,l.appendChild(t)}if(e.date){const t=r.cloneNode(!0);t.textContent=e.date,l.appendChild(t)}feedList.appendChild(i)}),handleFeedEvents()},handleFeedEvents=function(){const e=function(e){const t=e.target.closest(".feed__item"),o=t.querySelector(".feed__slide"),n=t.querySelector(".feed__link");t.querySelector(".feed__bookmark-btn").addEventListener("click",()=>{t.classList.toggle("feed__item--bookmarked")});const d=new Drag({el:n,container:o,right:128,finalAction:function(){parseInt(o.style.left,10)>=100&&t.classList.toggle("feed__item--bookmarked"),o.style.transition=".3s",o.style.left=0,setTimeout(()=>{o.removeAttribute("style")},300)}});e.target.closest(".feed__link")&&d.onEvent(e)};feedList.addEventListener("touchstart",e,{passive:!0}),feedList.addEventListener("mousedown",e)},activateMapFeed=function(){const e=document.querySelector(".map").querySelector(".map__control--feed"),t=feed.querySelector(".feed__title"),o=feed.querySelector(".feed__subtitle"),n=feed.querySelector(".feed__toggle-btn"),d=function(e){n.addEventListener("click",c),renderFeed(e),document.body.classList.add("no-scroll"),feed.classList.add("feed--show"),feed.querySelectorAll(".feed__item")[0].classList.add("feed__item--rounded"),feed.addEventListener("touchstart",i,{passive:!0}),feed.addEventListener("mousedown",i)},r=function(){parseInt(feed.style.top,10)>=100&&0===feed.scrollTop?(feed.removeEventListener("touchstart",i),feed.removeEventListener("mousedown",i),c()):parseInt(feed.style.top,10)<100&&(feed.style.transition=".3s",feed.style.top=0,setTimeout(()=>{feed.removeAttribute("style")},300))},i=function(e){if(e.target.closest(".feed__title-bar")){const t=feed.querySelector(".feed__title-bar"),o=feed.offsetHeight;new Drag({el:t,container:feed,bottom:o,finalAction:r}).onEvent(e)}},c=function(){feed.style.transition=".6s",feed.style.transform="translateY(100%)",setTimeout(()=>{document.body.classList.remove("no-scroll"),feedList.textContent="",feed.classList.remove("feed--show"),feed.removeAttribute("style")},550),n.removeEventListener("click",c)};e.addEventListener("click",(function(){d(data.globalEvents),t.textContent="Events",o.textContent=data.eventCount+" Upcoming Events"})),window.receiveLocalFeed=function(e){d(data.localEvents),t.textContent=e.position.city,o.textContent=e.position.country}};export const activateFeed=function(){const e=document.querySelector(".page-wrapper");e.classList.contains("page-wrapper--main")&&renderFeed(data.generalFeed),e.classList.contains("page-wrapper--map")&&activateMapFeed()};